{
  "hash": "1503a058b93ac418b9c477b42732002c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Byron\"\ndate: 2025-10-12\ndescription: \"I like burgers!\"\nimage: \"\"\ntwitter-card:\n  image: \"\"\nopen-graph:\n  image: \"\"\ncategories:\n  - map\n  - restaurants\n  - industry dynamics\nresources:\n  - \"img/*\"\ndoi: \"\"\ncitation: true\ndraft: true\n---\n\nI was having lunch at Honest Burgers near campus with a few people and the conversation somehow turned to Byron, the burger chain, and I found myself telling the story of its rise and downfall.\nOr, at least, a very simplistic version of it based on my limited knowledge of what happened.\nBut that led me to wonder if it would be possible to map the fortunes of Byron.\nThe following is an attempt at doing so.\n\n# Finding data\n\nIn order to find the data, I will use OpenStreetMap data, using the `osmdata` package in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(osmdata)\nlibrary(dplyr)\nlibrary(ggspatial)\n\nlondon <- getbb(\"London, UK\")\n\nlondon_restaurants <- london |> \n  opq() |> \n  add_osm_feature(key = \"amenity\", value = \"restaurant\") |> \n  osmdata_sf()\n\nlondon_admin <- london |> \n  opq() |> \n  add_osm_feature(key = 'admin_level', \n                  value = \"8\") |> \n  osmdata_sf() |> \n  with(osm_multipolygons)\n\nlibrary(ggplot2)\n\nggplot() +\n  geom_sf(data = london_admin) +\n    geom_sf(data = london_restaurants$osm_polygons)\n\n\n# You can then select by brand... i.e. Byron, Gourmet Burger Kitchen, etc.\n# Also by type of food.\n\nlondon_burgers <- london_restaurants |>\n  dplyr::filter(grepl(\"Byron|Gourmet Burger|Five Guys|Honest Burger|GBK\", osmpolygons$name, ignore.case = TRUE))\n\n# This highlights some data issues. Of the 3 Byrons in London, this only catches 2. Of the 9 GBK in London, it only catches 3.\n\n# Let's try to build the subset in the call to data\n\nlondon_b <- london |> \n  opq() |> \n  add_osm_feature(key = \"amenity\", value = \"restaurant\") |> \n  add_osm_feature(key = \"name\", \n                  value = c(\"Byron\", \"Gourmet Burger Kitchen\", \"Five Guys\", \"Honest Burger\", \"GBK\"),\n                  match_case = FALSE, value_exact = FALSE) |>\n  osmdata_sf()\n\n# One would think that using the brand variable would make more sense than the name, but there is a lot of restaurant missing brand info that are the correct restaurants...\n\n# It looks like for dplyr to work correctly with this object, you need ggspatial loaded... I need to investigate.\n\nlondon_b_points <- london_b$osm_points |> \n    dplyr::filter(!is.na(name))\n\nggplot() +\n  geom_sf(data = london_admin) +\n    geom_sf(data = london_b_points, size = 1.5, aes(colour = name), na.rm = TRUE) +\n    theme_void()\n```\n:::\n\n\n\n\nThis highlights some data issues. Of the 3 Byrons in London, this only catches 2. Of the 9 GBK in London, it only catches 3.\nI also catch none of the Five Guys...\nMaybe there is some vagueness in the classification and some of these get classified as fast food rather than restaurants?\nLet's see.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlondon_b2 <- london |> \n  opq() |> \n  add_osm_feature(key = \"amenity\", value = c(\"restaurant\", \"fast_food\")) |> \n  add_osm_feature(key = \"name\", \n                  value = c(\"Byron\", \"Gourmet Burger Kitchen\", \"Five Guys\", \"Honest Burger\", \"GBK\"),\n                  match_case = FALSE, value_exact = FALSE) |>\n  osmdata_sf()\n\nlondon_b2_points <- london_b2$osm_points |> \n    dplyr::filter(!is.na(name))\n\nggplot() +\n  geom_sf(data = london_admin) +\n    geom_sf(data = london_b2_points, size = 1.5, aes(colour = name), na.rm = TRUE) +\n    theme_void()\n```\n:::\n\n\nThis is better, we now catch Five Guys, and more of the Gourmet Burger Kitchen (7/9), but still only 2 out of 3 Byrons.\nLet's try widening the net one last time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlondon_b3 <- london |> \n  opq() |> \n  add_osm_feature(key = \"amenity\", value = c(\"restaurant\", \"fast_food\", \"food_court\", \"bar\", \"cafe\", \"pub\")) |> \n  add_osm_feature(key = \"name\", \n                  value = c(\"Byron\", \"Gourmet Burger Kitchen\", \"Five Guys\", \"Honest Burger\", \"GBK\"),\n                  match_case = FALSE, value_exact = FALSE) |>\n  osmdata_sf()\n\nlondon_b3_points <- london_b3$osm_points |> \n    dplyr::filter(!is.na(name))\n\nlondon_b3_points <- london_b3_points |>\n  dplyr::mutate(\n    name = dplyr::case_when(\n      grepl(\"five guys\", name, ignore.case = TRUE) ~ \"Five Guys\",\n      grepl(\"gourmet burger kitchen|\\\\bgbk\\\\b\", name, ignore.case = TRUE) ~ \"GBK\",\n      grepl(\"honest burger\", name, ignore.case = TRUE) ~ \"Honest Burgers\",\n      grepl(\"byron\", name, ignore.case = TRUE) ~ \"Byron\",\n      TRUE ~ NA_character_\n    )\n  )\n\nggplot() +\n  geom_sf(data = london_admin) +\n    geom_sf(data = london_b3_points, size = 1.5, aes(colour = name), na.rm = TRUE) +\n    theme_void()\n```\n:::\n\n\nNo, this does not yield anything further.\n\n# Making a base map\n\nSo now that we have the data (however imperfect it might be), let's try to make a nice base map. \nThe very rapid one we did is ok, but not particularly clear.\nIt is also not very easy to distinguish the different restaurants, and it appears there is some overplotting.\nSwitching the mapping of brand from colour to shape, and using an alpha value below one should help a bit.\nWe can also change the title of the legend. \nWe can also add a scale using the `ggspatial` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggspatial)\n\nggplot() +\n  geom_sf(data = london_admin) +\n    geom_sf(data = london_b3_points, size = 1.5, aes(shape = name), na.rm = TRUE, alpha = 0.5) +\n    annotation_scale() +\n      labs(\n      x = NULL,\n      y = NULL,\n      title = \"Burger chains in London\", \n      subtitle = \"\", \n      caption = \"Source: OpenStreetMap\",\n      shape = \"Chain\"\n      ) +\n    theme_void()\n```\n:::\n\n\n\nOk, so this gives a a basic map of what things look like now. \nBut can we go back in time and get historical data for these restaurants?\n\n# Finding \"historical\" data\n\nWith OpenStreetMap, it is possible to get data from the state of OpenStreetMap going back to sometime in 2012 when the licence of the data changed.\nThis is done using the `datetime` argument in the `osmdata` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlondon_2020 <- london |> \n    # opq() |>\n  opq(datetime = \"2020-01-01T00:00:00Z\", timeout = 200) |> \n  add_osm_feature(key = \"amenity\", value = c(\"restaurant\", \"fast_food\", \"food_court\", \"bar\", \"cafe\", \"pub\")) |> \n  add_osm_feature(key = \"name\", \n                  value = c(\"Byron\", \"Gourmet Burger Kitchen\", \"Five Guys\", \"Honest Burger\", \"GBK\"),\n                  match_case = FALSE, value_exact = FALSE) |>\n  osmdata_sf()\n\n\n# london_2020_points <- london_2020$osm_points |> \n    # dplyr::filter(!is.na(name))\nlondon_2020_points <- london_2020$osm_points[!is.na(london_2020$osm_points$name), ]\n# recoding\nlondon_2020_points <- london_2020_points |>\n  dplyr::mutate(\n    name = dplyr::case_when(\n      grepl(\"five guys\", name, ignore.case = TRUE) ~ \"Five Guys\",\n      grepl(\"gourmet burger kitchen|\\\\bgbk\\\\b\", name, ignore.case = TRUE) ~ \"GBK\",\n      grepl(\"honest burger\", name, ignore.case = TRUE) ~ \"Honest Burgers\",\n      grepl(\"byron\", name, ignore.case = TRUE) ~ \"Byron\",\n      TRUE ~ NA_character_\n    )\n  )\n\nggplot() +\n  geom_sf(data = london_admin) +\n    geom_sf(data = london_2020_points, size = 1.5, aes(shape = name), na.rm = TRUE, alpha = 0.5) +\n    annotation_scale() +\n      labs(\n      x = NULL,\n      y = NULL,\n      title = \"Burger chains in London (2020)\", \n      subtitle = \"\", \n      caption = \"Source: OpenStreetMap\",\n      shape = \"Chain\"\n      ) +\n    theme_void()\n```\n:::\n\n\nSo this demonstrate getting data from one specific point in the past. \nNow, we want to do this for several point in times as far back as we can go with OpenStreetMap data, which is 12 September 2012.\nLet build a series of dates to query from that time to today. \nAt first, I will try to do this roughly every six months.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntime_points <- seq(\n  from = as.POSIXct(\"2012-09-13T00:00:00Z\", tz = \"UTC\"),\n  to = Sys.time(),\n  by = \"6 months\"\n)\n```\n:::\n\n\n# Using gganimate\n\nYou can use the datetime argument in osmdata to get data up to a specific date.\nSo we can write a series of queries to store our data at different points in time.\n\nto animate through time.\n\n# Conclusion",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}